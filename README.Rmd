---
title: "DS 2020 Final Project Report"
author: "David Wang, Logan Pappas"
date: "2025-11-30"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# load the data and library
library(tidyverse)

electric_vehicle_population_data <- read_csv("Electric_Vehicle_Population_Data.csv")

head(electric_vehicle_population_data)
glimpse(electric_vehicle_population_data)
dim(electric_vehicle_population_data)
```
Topic:
Differences in electric range across various vehicle makes,models, and range

How does electric range differ across vehicle makes?
How does electric range differ across models within the same make?
Do newer models within the same make tend to have higher range?
How does electric range differ between BEVs and PHEVs across makes?
Do average electric ranges differ across rural and urban cities?


```{r}
###cleaning to find median
electric_vehicle_population_data <- electric_vehicle_population_data %>%
  mutate(
    `Electric Range` = replace_na(`Electric Range`, median(`Electric Range`, na.rm = TRUE)),
    `Base MSRP` = replace_na(`Base MSRP`, median(`Base MSRP`, na.rm = TRUE))
  )

```

```{r}
#fixing data types
electric_vehicle_population_data <- electric_vehicle_population_data |>
  mutate(
    `Model Year` = as.integer(`Model Year`),
    `Postal Code` = as.character(`Postal Code`),
    `Legislative District` = as.factor(`Legislative District`),
    State = as.factor(State),
    `Electric Vehicle Type` = as.factor(`Electric Vehicle Type`),
    `Clean Alternative Fuel Vehicle (CAFV) Eligibility` =
      as.factor(`Clean Alternative Fuel Vehicle (CAFV) Eligibility`)
  )

#remove dupes
electric_vehicle_population_data <- electric_vehicle_population_data |>
  distinct(`VIN (1-10)`, `Model Year`, .keep_all = TRUE)

glimpse(electric_vehicle_population_data)

dim(electric_vehicle_population_data)
```

```{r}
library(tidyverse)
#we filter for vehicles that have electric range > 0 as we only care about electric cars
ev_plot <- electric_vehicle_population_data |>
  filter(!is.na(`Electric Range`), `Electric Range` > 0)

```


```{r}
#How does electric range differ across vehicle makes?

ev_plot |>
  ggplot(aes(x = reorder(Make, `Electric Range`, FUN = median),
             y = `Electric Range`)) +
  geom_boxplot() +
  coord_flip() +
  labs(
    title = "Electric Range Distribution by Vehicle Make",
    x = "Make",
    y = "Electric Range (miles)"
  )

```

```{r}
top_makes <- ev_plot |>
  count(Make, sort = TRUE) |>
  slice_head(n = 6) |>
  pull(Make)

ev_plot |>
  filter(Make %in% top_makes) |>
  ggplot(aes(
    x = `Electric Range`,
    y = interaction(Make, Model)
  )) +
  geom_boxplot() +
  facet_wrap(~ Make, scales = "free_y") +
  labs(
    title = "Electric Range by Model Within Top Vehicle Makes",
    x = "Electric Range (miles)",
    y = "Model"
  )


```

```{r}
urban_rural_lookup <- tibble(
  City = c("Seattle", "Tacoma", "Spokane", "Bellevue", "Olympia",
           "Orondo", "Orondo", "Orting", "Palouse", "Port Hadlock"),
  Urban_Rural = c("Urban", "Urban", "Urban", "Urban", "Urban",
                  "Rural", "Rural", "Rural", "Rural", "Rural")
)
ev_city_classified <- electric_vehicle_population_data %>%
  left_join(urban_rural_lookup, by = "City")

ev_city_classified %>%
  filter(!is.na(Urban_Rural)) %>%
  group_by(Urban_Rural) %>%
  summarise(avg_range = mean(`Electric Range`, na.rm = TRUE)) %>%
  ggplot(aes(x = Urban_Rural, y = avg_range, fill = Urban_Rural)) +
  geom_col() +
  labs(
    title = "Average Electric Range: Urban vs Rural Cities",
    x = "City Type",
    y = "Average Range (miles)"
  ) +
  scale_fill_manual(values = c("Urban" = "steelblue", "Rural" = "forestgreen"))

ev_city_classified %>%
  filter(!is.na(Urban_Rural)) %>%
  group_by(City, Urban_Rural) %>%
  summarise(avg_range = mean(`Electric Range`, na.rm = TRUE)) %>%
  ggplot(aes(x = reorder(City, avg_range), y = avg_range, fill = Urban_Rural)) +
  geom_col() +
  coord_flip() +
  labs(
    title = "Average Electric Range of Selected Urban and Rural Cities",
    x = "City",
    y = "Average Electric Range"
  )
```
```{r}
#Do newer models within the same make tend to have higher range?

ev_plot |>
  filter(Make %in% top_makes) |>
  group_by(Make, `Model Year`) |>
  summarise(
    avg_range = mean(`Electric Range`),
    .groups = "drop"
  ) |>
  ggplot(aes(x = `Model Year`, y = avg_range, color = Make)) +
  geom_line() +
  geom_point() +
  labs(
    title = "Average Electric Range Over Time by Make",
    x = "Model Year",
    y = "Average Electric Range (miles)"
  )

```
